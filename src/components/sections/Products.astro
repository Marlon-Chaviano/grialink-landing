---
import { Image } from "astro:assets";
import Container from "@/components/ui/Container.astro";
import { type Lang, localizedHref } from "@/i18n/config";
import { getTranslations } from "@/i18n/utils";
import studyCase from "@/assets/study-case.jpg";

interface Props {
	lang: Lang;
}

const { lang } = Astro.props;
const p = getTranslations(lang, "products") as Record<string, any>;

const productIcons = [
	"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z",
	"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5",
	"M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3",
	"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z",
];

const productLinks = ["/products#prospector", "/products#outreach", "/products#crm", "/products#analytics"];

const productsList = (p.products ?? []) as Array<{
	title: string;
	description: string;
	color: string;
}>;

const products = productsList.map((prod, i) => ({
	icon: productIcons[i] ?? productIcons[0],
	title: prod.title,
	description: prod.description,
	color: prod.color,
	link: localizedHref(productLinks[i] ?? "/products", lang),
}));

const cs = p.caseStudy as Record<string, string>;

const colorMap: Record<string, { bg: string; text: string; link: string }> = {
	blue: {
		bg: "bg-blue-500/15",
		text: "text-blue-400",
		link: "text-blue-400",
	},
	green: {
		bg: "bg-emerald-500/15",
		text: "text-emerald-400",
		link: "text-emerald-400",
	},
	emerald: {
		bg: "bg-emerald-500/15",
		text: "text-emerald-400",
		link: "text-emerald-400",
	},
	purple: {
		bg: "bg-purple-500/15",
		text: "text-purple-400",
		link: "text-purple-400",
	},
	orange: {
		bg: "bg-primary/15",
		text: "text-primary",
		link: "text-primary",
	},
};

const defaultColor = colorMap.blue;
---

<section class="section-spacing bg-secondary">
	<Container>
		<h2
			class="text-3xl md:text-5xl font-bold text-foreground mb-16 max-w-2xl"
			data-animate
		>
			{p.heading}
		</h2>

		<div
			class="grid grid-cols-1 lg:grid-cols-2 gap-12"
			data-animate
		>
			<!-- Product cards -->
			<div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
				{
					products.map((product) => {
						const colors = colorMap[product.color] ?? defaultColor;
						return (
							<div class="p-6 rounded-2xl border border-border hover:shadow-lg transition-all duration-300 bg-card group">
								<div
									class:list={[
										"w-12 h-12 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",
										colors.bg,
										colors.text,
									]}
								>
									<svg
										class="w-6 h-6"
										fill="none"
										stroke="currentColor"
										stroke-width="1.5"
										viewBox="0 0 24 24"
									>
										<path
											stroke-linecap="round"
											stroke-linejoin="round"
											d={product.icon}
										/>
									</svg>
								</div>
								<h3 class="text-xl font-bold text-foreground mb-2">{product.title}</h3>
								<p class="text-muted-foreground text-sm mb-4">{product.description}</p>
								<a
									class:list={["text-sm font-semibold hover:underline", colors.link]}
									href={product.link}
								>
									{p.learnMore}
								</a>
							</div>
						);
					})
				}
			</div>

			<!-- Case study -->
			<div class="relative rounded-3xl overflow-hidden h-full min-h-100">
				<Image
					alt={cs.imgAlt}
					class="absolute inset-0 w-full h-full object-cover"
					src={studyCase}
					loading="lazy"
					decoding="async"
					widths={[480, 800, 1200]}
					sizes="(max-width: 1024px) 100vw, 50vw"
				/>
				<div class="absolute inset-0 bg-linear-to-t from-black/80 to-transparent flex items-end p-8">
					<div>
						<span class="bg-primary text-primary-foreground text-xs px-3 py-1 rounded-full inline-block mb-3"> {cs.badge} </span>
						<h3 class="text-white text-2xl font-bold mb-2">{cs.title}</h3>
						<p class="text-white/70">
							{cs.quote}
						</p>
					</div>
				</div>
			</div>
		</div>
	</Container>
</section>
