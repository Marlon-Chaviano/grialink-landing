---
import Container from "@/components/ui/Container.astro";
import { type Lang } from "@/i18n/config";
import { getTranslations } from "@/i18n/utils";

interface Props {
	lang: Lang;
}

const { lang } = Astro.props;
const t = getTranslations(lang, 'howItWorks');

const steps = t.steps as Array<{
	number: string;
	title: string;
	description: string;
	icon: string;
}>;

const iconMap: Record<string, string> = {
	account: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>`,
	channels: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>`,
	pipeline: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"/>`,
	ai: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"/>`,
};
---

<section id="how-it-works" class="section-spacing bg-background relative overflow-hidden">
	<!-- Subtle background decoration -->
	<div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-primary/3 rounded-full blur-[120px] -z-10" aria-hidden="true"></div>

	<Container>
		<!-- Header -->
		<div class="text-center max-w-2xl mx-auto mb-16" data-animate>
			<div class="inline-flex items-center gap-2 px-3.5 py-1.5 mb-6 text-xs font-medium tracking-wide text-primary bg-primary/8 rounded-full border border-primary/15">
				<span class="w-1.5 h-1.5 rounded-full bg-primary animate-pulse"></span>
				{t.badge}
			</div>
			<h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-foreground mb-4 tracking-tight leading-[1.1]">
				{t.title}
			</h2>
			<p class="text-base lg:text-lg text-muted-foreground leading-relaxed">
				{t.subtitle}
			</p>
		</div>

		<!-- Steps -->
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 relative">
			<!-- Connecting line (desktop only) -->
			<div class="hidden lg:block absolute top-14 left-[15%] right-[15%] h-px bg-gradient-to-r from-transparent via-border to-transparent" aria-hidden="true"></div>

			{steps.map((step, index) => (
				<div
					class="relative flex flex-col items-center text-center group"
					data-animate
					style={`transition-delay: ${index * 80}ms`}
				>
					<!-- Step icon box -->
					<div class="relative z-10 w-28 h-28 mb-6 rounded-2xl bg-card border border-border-light flex flex-col items-center justify-center group-hover:border-primary/20 group-hover:shadow-lg group-hover:shadow-primary/5 transition-all duration-300">
						<div class="w-8 h-8 mb-2 text-primary">
							<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<Fragment set:html={iconMap[step.icon]} />
							</svg>
						</div>
						<span class="text-[10px] font-bold text-muted-foreground uppercase tracking-widest">
							{step.number}
						</span>
					</div>

					<!-- Content -->
					<h3 class="text-base font-bold text-foreground mb-2">
						{step.title}
					</h3>
					<p class="text-sm text-muted-foreground leading-relaxed max-w-[240px]">
						{step.description}
					</p>
				</div>
			))}
		</div>

		<!-- Bottom CTA -->
		<div class="mt-16 text-center" data-animate>
			<a
				href="https://app.grialink.com/app/auth/register"
				class="group inline-flex items-center gap-2 bg-primary hover:bg-primary-hover text-primary-foreground px-7 py-3.5 rounded-full text-base font-semibold transition-all duration-200 shadow-lg shadow-primary/20 hover:shadow-xl hover:shadow-primary/30 hover:-translate-y-0.5"
			>
				{t.cta}
				<svg class="w-4 h-4 group-hover:translate-x-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
				</svg>
			</a>
		</div>
	</Container>
</section>
